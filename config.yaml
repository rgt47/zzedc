# ZZedc Configuration File
# zzcollab-compatible configuration with environment-specific overrides
#
# This file provides centralized configuration for ZZedc Electronic Data Capture
# system, supporting development, testing, and production deployments.

# Default configuration (shared across all environments)
default:
  # Project metadata
  project:
    name: "ZZedc"
    title: "ZZedc - Electronic Data Capture System"
    version: "1.0.0"
    description: "Production-ready EDC system with clinical trial validation DSL"
    organization: "ZZcollab"
    contact_email: "support@zzcollab.org"

  # Database configuration
  database:
    path: "data/zzedc.db"
    type: "sqlite"
    timeout: 30
    journal_mode: "wal"  # Write-Ahead Logging for better concurrency
    timeout_ms: 5000

  # Validation settings
  validation:
    cache_enabled: true
    cache_timeout_hours: 24
    timeout_ms: 5000
    max_rule_size_chars: 10000
    compilation_timeout_seconds: 10

  # Shiny application settings
  shiny:
    session_timeout: 3600  # seconds
    port: 3838
    host: "127.0.0.1"
    debug: false
    launch_browser: false

  # Security settings
  security:
    https_only: false  # Set to true in production
    session_token_length: 32
    password_min_length: 8
    password_require_special: true
    max_failed_login_attempts: 3
    account_lockout_minutes: 15

  # QC (Quality Control) settings
  qc:
    schedule: "2:00 AM"  # Nightly batch QC run time (HH:MM format)
    retain_days: 90  # Keep violation records for 90 days
    auto_resolve_duplicates: false
    notify_on_violations: false

  # Export settings
  export:
    formats: ["csv", "xlsx", "sas"]
    compression: "zip"
    max_records_per_file: 100000

  # Logging
  logging:
    level: "INFO"  # DEBUG, INFO, WARNING, ERROR
    console_output: true
    file_output: false
    file_path: null  # Set per environment

  # Email notifications
  email:
    enabled: false
    smtp_server: null
    smtp_port: 587
    from_address: null
    admin_address: null

# Development environment (extends default)
development:
  project:
    version: "1.0.0-dev"

  database:
    path: "data/zzedc_dev.db"
    timeout: 60

  validation:
    cache_enabled: false  # Disable caching for easier development
    timeout_ms: 10000

  shiny:
    debug: true
    launch_browser: true
    host: "0.0.0.0"  # Accept connections from any host

  security:
    https_only: false
    max_failed_login_attempts: 100  # Relaxed for testing

  logging:
    level: "DEBUG"
    console_output: true
    file_output: true
    file_path: "logs/zzedc_dev.log"

# Testing environment (for automated tests)
testing:
  database:
    path: ":memory:"  # In-memory SQLite for fast tests
    timeout: 10

  validation:
    cache_enabled: false
    timeout_ms: 5000

  shiny:
    debug: false
    port: 3838

  qc:
    schedule: null  # No scheduled QC in tests
    auto_resolve_duplicates: true

  logging:
    level: "WARNING"
    console_output: false

# Production environment (strict settings)
production:
  project:
    version: "1.0.0"

  database:
    path: "/var/lib/zzedc/data.db"
    timeout: 30
    journal_mode: "wal"
    # Database backups highly recommended in production

  validation:
    cache_enabled: true
    cache_timeout_hours: 24
    timeout_ms: 5000

  shiny:
    debug: false
    launch_browser: false
    host: "0.0.0.0"
    session_timeout: 1800  # 30 minutes

  security:
    https_only: true  # REQUIRED in production
    session_token_length: 32
    password_min_length: 12
    password_require_special: true
    max_failed_login_attempts: 3
    account_lockout_minutes: 30

  qc:
    schedule: "2:00 AM"
    retain_days: 90
    auto_resolve_duplicates: false
    notify_on_violations: true

  logging:
    level: "INFO"
    console_output: false
    file_output: true
    file_path: "/var/log/zzedc/app.log"

  email:
    enabled: true
    smtp_server: "smtp.yourorg.com"
    smtp_port: 587
    from_address: "zzedc@yourorg.com"
    admin_address: "admin@yourorg.com"

# zzcollab framework integration
zzcollab:
  enabled: true
  bundle_profile: "standard"  # Profiles defined in bundles.yaml
  framework_version: "1.0.0"

  # Module configuration
  modules:
    validation_dsl: true  # Enable DSL validation
    batch_qc: true  # Enable batch QC engine
    privacy: true  # GDPR compliance module
    compliance: true  # 21 CFR Part 11 compliance

  # zzcollab-specific features
  features:
    docker_support: true
    reproducible_environment: true
    ci_cd_ready: true
    package_management: true

# GDPR Compliance Configuration
gdpr:
  enabled: true

  legal_basis:
    regular_data: "legitimate_interest"
    special_category: "explicit_consent"

  retention:
    clinical_data: 300  # 25 years
    audit_logs: 84  # 7 years
    consent_records: 300
    user_accounts: 12

  rights:
    enable_access: true
    enable_rectification: true
    enable_erasure: true
    enable_portability: true

  privacy_notice:
    show_banner: true
    require_acknowledgment: true
    languages: ["en"]

# 21 CFR Part 11 Compliance Configuration
cfr_part11:
  enabled: true

  electronic_signatures:
    enabled: true
    required_components: ["printed_name", "date_time", "meaning"]
    signature_methods: ["password"]
    validation_required: true

  audit_trail:
    enhanced_logging: true
    immutable_records: true
    hash_chaining: true
    retention_years: 25

  validation:
    level: "operational"
    iq_required: true
    oq_required: true
    pq_required: true
    change_control: true

# Dual compliance integration
dual_compliance:
  enabled: true
  primary_jurisdiction: "EU"

  conflict_resolution:
    retention_priority: "regulatory"
    erasure_review_required: true
    regulatory_hold_enabled: true
