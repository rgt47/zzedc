################################################################################
# ZZedc Environment Configuration Template
#
# Instructions:
#   1. Copy this file: cp .env.template .env
#   2. Edit .env with your actual values
#   3. Keep .env secret (add to .gitignore, never commit to Git)
#   4. docker-compose will automatically load .env
#
# Security Notes:
#   - ZZEDC_SALT must be unique and kept secret
#   - ADMIN_PASSWORD will be used for initial login
#   - Never store this file in version control
#   - Restrict file permissions: chmod 600 .env
#
################################################################################

# CRITICAL SECURITY SETTING
# Generate new salt for each deployment:
#   openssl rand -hex 16
# Different salt = different encryption for each installation
# Changing salt after deployment will break existing password hashes!
ZZEDC_SALT=a7f9e2c4d1b3f8a6e9d2c5b8f1a4e7d0

# Study Configuration (customize for your trial)
STUDY_NAME=Depression Treatment Trial 2025
STUDY_ID=DEPR-2025-001
PI_EMAIL=pi@institution.edu

# Administrator Account (set strong password!)
# - Minimum 8 characters
# - Mix of uppercase, lowercase, numbers, special characters
# - Used for initial login only (change after first login)
# - Don't reuse passwords from other systems
ADMIN_PASSWORD=SecurePassword123!

# Application Settings
# Options: debug, info, warning, error
LOG_LEVEL=info

# (Optional) R Package Configuration
# Usually not needed, defaults to standard R packages
# R_DEFAULT_PACKAGES=base,methods,datasets,utils,grDevices,graphics,stats

################################################################################
# Quick Start
################################################################################

# 1. Generate security salt
#    ZZEDC_SALT=$(openssl rand -hex 16)
#    echo "Generated salt: $ZZEDC_SALT"
#    # Copy output and paste into ZZEDC_SALT= above

# 2. Set study details
#    STUDY_NAME="Your Study Name"
#    STUDY_ID="STUDY-YEAR-001"
#    PI_EMAIL="your.email@institution.edu"

# 3. Choose admin password
#    ADMIN_PASSWORD="YourSecurePassword123!"

# 4. Save this file as .env
#    chmod 600 .env  # Restrict permissions

# 5. Start application
#    docker-compose build
#    docker-compose up -d

# 6. Monitor startup
#    docker-compose logs -f

# 7. Access application
#    https://your-domain.org
#    Username: admin
#    Password: (from ADMIN_PASSWORD above)
#    Change password after first login!

################################################################################
# Variable Reference
################################################################################

# ZZEDC_SALT
# - Purpose: Encryption key for password hashing
# - Required: Yes
# - Format: 32-character hexadecimal string
# - How to generate:
#     openssl rand -hex 16      # macOS/Linux
#     # or use any other random source
# - Security: Keep this SECRET. Store in password manager.
# - Consequence: Changing this after deployment will break all passwords
#
# Example: a7f9e2c4d1b3f8a6e9d2c5b8f1a4e7d0

# STUDY_NAME
# - Purpose: Name of your clinical trial/study
# - Required: Yes
# - Format: Any text (can include spaces and special characters)
# - Examples:
#     - Depression Treatment Trial 2025
#     - ADHD Multisite Study (ADHD-MULTI-2025)
#     - Stroke Prevention Pilot
# - Note: Displayed in web interface and admin panel

# STUDY_ID
# - Purpose: Protocol/study identifier
# - Required: Yes
# - Format: Alphanumeric code (typically institution + year + number)
# - Examples:
#     - DEPR-2025-001
#     - ADHD-MULTI-2025
#     - STROKE-PILOT-001
# - Best practice: Match your institutional protocol number
# - Note: Used in audit logs and data exports

# PI_EMAIL
# - Purpose: Principal Investigator contact email
# - Required: Yes
# - Format: Valid email address
# - Examples:
#     - pi@institution.edu
#     - jane.smith@university.org
# - Note: Used for Let's Encrypt certificate notifications and alerts
# - Consequence: Let's Encrypt may send certificate renewal notifications

# ADMIN_PASSWORD
# - Purpose: Initial password for 'admin' user account
# - Required: Yes
# - Format: Strong password (8+ characters, mixed types)
# - Examples of STRONG passwords:
#     - SecurePass2025!
#     - MyStudy#123ABC
#     - P@ssw0rd$Trial2025
# - Examples of WEAK passwords (don't use):
#     - password123         (too simple)
#     - admin              (default, insecure)
#     - 12345678           (numbers only)
#     - Aa1                (too short)
# - Best practice: Generate random password
#     openssl rand -base64 12
# - IMPORTANT: Change this after first login!
# - Note: Only used for initial setup, change in web interface

# LOG_LEVEL
# - Purpose: Verbosity of application logging
# - Required: No (defaults to 'info')
# - Options:
#     - debug   (very detailed, use for troubleshooting only)
#     - info    (normal operations, recommended for production)
#     - warning (only warnings and errors)
#     - error   (errors only)
# - Note: Affects log file size and performance
# - Recommendation: Use 'info' for normal operation

################################################################################
# Examples of Complete .env Files
################################################################################

# EXAMPLE 1: Solo Researcher (Local Development)
# ---
# ZZEDC_SALT=1a2b3c4d5e6f7g8h9i0j1k2l3m4n5o6p
# STUDY_NAME=My Pilot Study
# STUDY_ID=PILOT-2025
# PI_EMAIL=jane@myuniversity.edu
# ADMIN_PASSWORD=MySecurePassword123!
# LOG_LEVEL=info

# EXAMPLE 2: Multi-Site Trial (AWS Deployment)
# ---
# ZZEDC_SALT=a7f9e2c4d1b3f8a6e9d2c5b8f1a4e7d0
# STUDY_NAME=Depression Treatment Effectiveness Trial (DTET)
# STUDY_ID=DTET-MULTI-2025
# PI_EMAIL=dr.robert.smith@ucsd.edu
# ADMIN_PASSWORD=TrialAdminPass2025#Research
# LOG_LEVEL=info

# EXAMPLE 3: Industry-Sponsored Trial
# ---
# ZZEDC_SALT=xyz123abc456def789ghi012jkl345
# STUDY_NAME=Alzheimer's Prevention Study (APS-005)
# STUDY_ID=APS-005
# PI_EMAIL=research.director@pharmacompany.com
# ADMIN_PASSWORD=Ph@rmaTrial2025Secure!
# LOG_LEVEL=info

################################################################################
# Security Best Practices
################################################################################

# 1. File Permissions
#    chmod 600 .env
#    # Only the file owner can read

# 2. Git Management
#    echo ".env" >> .gitignore
#    # Never commit to version control

# 3. Access Control
#    # Only ops/admin should have .env access
#    ls -la .env
#    # Should show: -rw------- (600)

# 4. Backup
#    # Store safely (password manager, AWS Secrets Manager, etc.)
#    # NOT in Git, NOT on shared drives without encryption

# 5. Rotation
#    # Passwords: Change annually or after personnel changes
#    # Salt: Never change after deployment (breaks passwords)

# 6. Audit
#    # Log who accesses .env file
#    # Monitor for unauthorized changes

################################################################################
# Deployment Workflow
################################################################################

# Step 1: Prepare environment file
#   cp .env.template .env
#   chmod 600 .env

# Step 2: Edit .env with your values
#   nano .env
#   # Edit STUDY_NAME, STUDY_ID, PI_EMAIL, ADMIN_PASSWORD
#   # Generate and set ZZEDC_SALT

# Step 3: Verify values
#   cat .env
#   # Review before deployment

# Step 4: Build and start
#   docker-compose build
#   docker-compose up -d

# Step 5: Monitor startup
#   docker-compose logs -f zzedc
#   # Wait for "Launching ZZedc application..."
#   # Then Ctrl+C to exit logs

# Step 6: Verify HTTPS
#   curl -I https://your-domain.org
#   # Should show: HTTP/2 200
#   # Certificate should be valid

# Step 7: Login and change password
#   Open browser: https://your-domain.org
#   Username: admin
#   Password: (from ADMIN_PASSWORD above)
#   Go to Settings → Change Password
#   Set new permanent password

################################################################################
# Troubleshooting
################################################################################

# Environment variable not loaded:
#   - Verify .env file exists in deployment directory
#   - Check file is named exactly ".env" (not .env.txt)
#   - Verify docker-compose can read it: cat .env
#   - Restart containers: docker-compose restart

# Password doesn't work after setup:
#   - Check ADMIN_PASSWORD value in .env
#   - Verify no extra spaces or quotes in password
#   - Reset admin user in database (see IT_STAFF_TROUBLESHOOTING.md)

# Salt-related password errors:
#   - ZZEDC_SALT must be set BEFORE first startup
#   - Changing salt after startup breaks all password hashes
#   - Never change ZZEDC_SALT after users are created

# Special characters in password:
#   - Supported: ! @ # $ % ^ & * ( ) - _ = +
#   - Avoid: quotes, backslashes, newlines
#   - Examples:
#     ADMIN_PASSWORD=Pass!123@xyz    ✓ Good
#     ADMIN_PASSWORD=Pass'123"xyz    ✗ Avoid quotes

################################################################################
# For More Information
################################################################################

# See deployment documentation:
#   - docker-compose.yml - Configuration details
#   - Dockerfile - Application environment
#   - IT_STAFF_DEPLOYMENT_CHECKLIST.md - Step-by-step guide
#   - IT_STAFF_TROUBLESHOOTING.md - Problem solving
#
# Contact for questions:
#   - ZZedc GitHub: https://github.com/rgt47/zzedc
#   - Email: rgthomas@ucsd.edu
